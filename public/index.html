<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Audio ‚Ü† Features</title>
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@600;700&display=swap" rel="stylesheet">
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}
			
			body {
				font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
				background: linear-gradient(135deg, #040506 0%, #481669 15%, #171a1e 30%, #722f97 50%, #2d3748 70%, #1a2e1a 85%, #3a1e91 100%);
				background-size: 300% 300%;
				animation: professionalFlow 25s ease-in-out infinite;
				min-height: 100vh;
				display: flex;
				align-items: center;
				justify-content: center;
				padding: 20px;
			}
			
			@keyframes professionalFlow {
				0% {
					background-position: 0% 50%;
				}
				50% {
					background-position: 100% 50%;
				}
				100% {
					background-position: 0% 50%;
				}
			}
			
			.container {
				background: rgba(255, 255, 255, 0.12);
				backdrop-filter: blur(30px);
				border: 4px solid rgba(165, 34, 197, 0.2);
				border-radius: 28px;
				box-shadow: 0 30px 60px rgba(0, 0, 0, 0.2), 0 0 0 1px rgba(34, 197, 94, 0.1);
				padding: 45px;
				max-width: 520px;
				width: 100%;
				text-align: center;
			}
			
			h1 {
				font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
				color: #f7fafc;
				margin-bottom: 15px;
				font-size: 2.6rem;
				font-weight: 700;
				letter-spacing: -0.02em;
				text-shadow: 0 2px 10px rgba(0, 0, 0, 0.25);
			}
			
			.subtitle {
				color: #e2e8f0;
				margin-bottom: 45px;
				font-size: 1.15rem;
				font-weight: 400;
				letter-spacing: 0.3px;
				line-height: 1.5;
			}
			
			.upload-area {
				border: 2px dashed rgba(34, 197, 94, 0.4);
				border-radius: 24px;
				padding: 70px 25px;
				background: rgba(34, 197, 94, 0.05);
				backdrop-filter: blur(20px);
				transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
				cursor: pointer;
				position: relative;
				overflow: hidden;
			}
			
			.upload-area:hover {
				border-color: rgba(34, 197, 94, 0.6);
				background: rgba(34, 197, 94, 0.08);
				transform: translateY(-4px);
				box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2), 0 0 0 1px rgba(34, 197, 94, 0.2);
			}
			
			.upload-area.dragover {
				border-color: rgba(34, 197, 94, 0.8);
				background: rgba(34, 197, 94, 0.12);
				transform: scale(1.02);
				box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(34, 197, 94, 0.3);
			}
			
			.upload-icon {
				font-size: 3.5rem;
				color: rgba(34, 197, 94, 0.8);
				margin-bottom: 25px;
				filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
			}
			
			.upload-text {
				font-size: 1.3rem;
				color: #f7fafc;
				margin-bottom: 12px;
				font-weight: 500;
				letter-spacing: 0.5px;
			}
			
			.upload-subtext {
				color: #e2e8f0;
				font-size: 1rem;
				letter-spacing: 0.3px;
			}
			
			.file-input {
				display: none;
			}
			
			.file-info {
				margin-top: 25px;
				padding: 20px;
				background: rgba(34, 197, 94, 0.08);
				border-radius: 16px;
				display: none;
				border: 1px solid rgba(34, 197, 94, 0.2);
				backdrop-filter: blur(10px);
			}
			
			.file-info.show {
				display: block;
			}
			
			.file-name {
				font-weight: 500;
				color: #f7fafc;
				margin-bottom: 8px;
				font-size: 1.1rem;
				letter-spacing: 0.3px;
			}
			
			.file-size {
				color: #e2e8f0;
				font-size: 0.95rem;
				letter-spacing: 0.2px;
			}
			
			.upload-btn {
				background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
				background-size: 200% 200%;
				animation: professionalShimmer 8s ease-in-out infinite;
				color: #ffffff;
				border: 1px solid #22c55e;
				padding: 18px 35px;
				border-radius: 30px;
				font-size: 1.15rem;
				font-weight: 500;
				cursor: pointer;
				margin-top: 25px;
				transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
				opacity: 0;
				transform: translateY(20px);
				backdrop-filter: blur(10px);
				letter-spacing: 0.5px;
			}
			
			@keyframes professionalShimmer {
				0% {
					background-position: 0% 50%;
				}
				50% {
					background-position: 100% 50%;
				}
				100% {
					background-position: 0% 50%;
				}
			}
			
			.upload-btn.show {
				opacity: 1;
				transform: translateY(0);
			}
			
			.upload-btn:hover {
				transform: translateY(-3px);
				box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2), 0 0 0 1px #22c55e;
				background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
			}
			
			.upload-btn:disabled {
				opacity: 0.6;
				cursor: not-allowed;
				transform: none;
			}
			
			.progress-bar {
				width: 100%;
				height: 8px;
				background: rgba(255, 255, 255, 0.15);
				border-radius: 4px;
				margin-top: 20px;
				overflow: hidden;
				display: none;
				backdrop-filter: blur(5px);
			}
			
			.progress-bar.show {
				display: block;
			}
			
			.progress-fill {
				height: 100%;
				background: linear-gradient(90deg, #1c8b45, #16a34aab);
				background-size: 200% 200%;
				animation: professionalProgressFlow 6s ease-in-out infinite;
				width: 0%;
				transition: width 0.4s ease;
				border-radius: 4px;
			}
			
			@keyframes professionalProgressFlow {
				0% {
					background-position: 0% 50%;
				}
				50% {
					background-position: 100% 50%;
				}
				100% {
					background-position: 0% 50%;
				}
			}
			
			.result {
				margin-top: 25px;
				padding: 25px;
				background: rgba(34, 197, 94, 0.08);
				border-radius: 16px;
				display: none;
				color: #f7fafc;
				border: 1px solid rgba(34, 197, 94, 0.2);
				backdrop-filter: blur(10px);
			}
			
			.result.show {
				display: block;
			}
			
			/* Add a little spacing below the result heading */
			.result h3 {
				margin-bottom: 12px;
			}
			
			.error {
				background: rgba(197, 48, 48, 0.2);
				color: #fed7d7;
				border-color: rgba(188, 46, 46, 0.4);
			}
			
			.result-section {
				margin-bottom: 25px;
				padding: 20px;
				background: rgba(255, 255, 255, 0.05);
				border-radius: 12px;
				border: 1px solid rgba(255, 255, 255, 0.1);
			}
			
			.result-section h4 {
				color: #f7fafc;
				margin-bottom: 15px;
				font-size: 1.2rem;
				font-weight: 600;
			}
			
			.transcription-text {
				background: rgba(34, 197, 94, 0.1);
				padding: 15px;
				border-radius: 8px;
				border-left: 4px solid #22c55e;
				color: #e2e8f0;
				line-height: 1.6;
				font-style: italic;
			}
			
			.feature-requests {
				display: flex;
				flex-direction: column;
				gap: 15px;
			}
			
			.feature-request {
				background: rgba(255, 255, 255, 0.08);
				padding: 20px;
				border-radius: 12px;
				border: 1px solid rgba(255, 255, 255, 0.1);
				transition: all 0.3s ease;
			}
			
			.feature-request:hover {
				transform: translateY(-2px);
				box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
			}
			
			.feature-request.priority-high {
				border-left: 4px solid #ef4444;
			}
			
			.feature-request.priority-medium {
				border-left: 4px solid #f59e0b;
			}
			
			.feature-request.priority-low {
				border-left: 4px solid #22c55e;
			}
			
			.request-header {
				display: flex;
				align-items: center;
				gap: 10px;
				margin-bottom: 12px;
			}
			
			.category-icon {
				font-size: 1.5rem;
			}
			
			.request-header h5 {
				color: #f7fafc;
				font-size: 1.1rem;
				font-weight: 600;
				margin: 0;
				flex: 1;
			}
			
			.confidence {
				background: rgba(34, 197, 94, 0.2);
				color: #22c55e;
				padding: 4px 8px;
				border-radius: 12px;
				font-size: 0.8rem;
				font-weight: 500;
			}
			
			.request-description {
				color: #e2e8f0;
				line-height: 1.5;
				margin-bottom: 15px;
			}
			
			.request-meta {
				display: flex;
				gap: 10px;
				align-items: center;
			}
			
			.priority-badge {
				padding: 4px 12px;
				border-radius: 16px;
				font-size: 0.75rem;
				font-weight: 600;
				text-transform: uppercase;
				letter-spacing: 0.5px;
			}
			
			.priority-badge.priority-high {
				background: rgba(239, 68, 68, 0.2);
				color: #fca5a5;
			}
			
			.priority-badge.priority-medium {
				background: rgba(245, 158, 11, 0.2);
				color: #fcd34d;
			}
			
			.priority-badge.priority-low {
				background: rgba(34, 197, 94, 0.2);
				color: #86efac;
			}
			
			.category-badge {
				background: rgba(74, 34, 197, 0.2);
				color: #a78bfa;
				padding: 4px 12px;
				border-radius: 16px;
				font-size: 0.75rem;
				font-weight: 500;
				text-transform: capitalize;
			}
			
			.extraction-summary {
				margin-top: 20px;
				padding: 15px;
				background: rgba(34, 197, 94, 0.1);
				border-radius: 8px;
				border: 1px solid rgba(34, 197, 94, 0.2);
			}
			
			.extraction-summary p {
				margin-bottom: 8px;
				color: #e2e8f0;
			}
			
			.extraction-summary small {
				color: #94a3b8;
				font-size: 0.85rem;
			}
			
			.potential-recommendation {
				margin: 15px 0;
				padding: 12px;
				background: rgba(59, 130, 246, 0.1);
				border-radius: 8px;
				border: 1px solid rgba(59, 130, 246, 0.2);
			}
			
			.potential-recommendation h6 {
				color: #93c5fd;
				font-size: 0.9rem;
				font-weight: 600;
				margin-bottom: 8px;
				display: flex;
				align-items: center;
				gap: 6px;
			}
			
			.recommendation-content {
				color: #e2e8f0;
				font-size: 0.9rem;
				line-height: 1.5;
			}
		</style>
	</head>
	<body>
		<canvas id="starfield"></canvas>
		<div class="container">
			<h1>AUDIO ‚ûú FEATURES</h1>
			<p class="subtitle">~üîä Upload an audio file to get feature requests~</p>
			
			<div class="upload-area" id="uploadArea">
				<div class="upload-icon">üéµ</div>
				<div class="upload-text">Drop your audio file here</div>
				<div class="upload-subtext">or click to browse files</div>
				<input type="file" id="fileInput" class="file-input" accept="audio/*" />
			</div>
			
			<div class="file-info" id="fileInfo">
				<div class="file-name" id="fileName"></div>
				<div class="file-size" id="fileSize"></div>
			</div>
			
			<button class="upload-btn" id="uploadBtn" disabled>
				Process Audio
			</button>
			
			<div class="progress-bar" id="progressBar">
				<div class="progress-fill" id="progressFill"></div>
			</div>
			
			<div class="result" id="result"></div>
		</div>

		<script>
(function() {
  const canvas = document.getElementById('starfield');
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  let w, h, dpr, stars;
  const STAR_COUNT = 80;
  const STAR_COLORS = [
    'rgba(255,255,255,0.7)',
    'rgba(34,197,94,0.5)', // green
    'rgba(74,34,197,0.4)'  // purple
  ];
  function resize() {
    dpr = window.devicePixelRatio || 1;
    w = window.innerWidth;
    h = window.innerHeight;
    canvas.width = w * dpr;
    canvas.height = h * dpr;
    canvas.style.width = w + 'px';
    canvas.style.height = h + 'px';
    ctx.setTransform(1, 0, 0, 1, 0, 0);
    ctx.scale(dpr, dpr);
  }
  function randomStar() {
    const color = STAR_COLORS[Math.floor(Math.random() * STAR_COLORS.length)];
    return {
      x: Math.random() * w,
      y: Math.random() * h,
      r: Math.random() * 1.1 + 0.3,
      speed: 0.05 + Math.random() * 0.07,
      color,
      twinkle: Math.random() * Math.PI * 2
    };
  }
  function createStars() {
    stars = [];
    for (let i = 0; i < STAR_COUNT; i++) {
      stars.push(randomStar());
    }
  }
  function draw() {
    ctx.clearRect(0, 0, w, h);
    for (let star of stars) {
      ctx.save();
      ctx.globalAlpha = 0.5 + 0.3 * Math.sin(star.twinkle);
      ctx.beginPath();
      ctx.arc(star.x, star.y, star.r, 0, Math.PI * 2);
      ctx.fillStyle = star.color;
      ctx.shadowColor = star.color;
      ctx.shadowBlur = 8;
      ctx.fill();
      ctx.restore();
      // Move star
      star.y += star.speed;
      star.twinkle += 0.01 + Math.random() * 0.01;
      if (star.y > h + 2) {
        star.x = Math.random() * w;
        star.y = -2;
      }
    }
    requestAnimationFrame(draw);
  }
  function setup() {
    resize();
    createStars();
    draw();
  }
  window.addEventListener('resize', () => {
    resize();
    createStars();
  });
  // Style the canvas
  canvas.style.position = 'fixed';
  canvas.style.top = '0';
  canvas.style.left = '0';
  canvas.style.width = '100vw';
  canvas.style.height = '100vh';
  canvas.style.zIndex = '0';
  canvas.style.pointerEvents = 'none';
  canvas.style.opacity = '0.45';
  setup();
})();
			const uploadArea = document.getElementById('uploadArea');
			const fileInput = document.getElementById('fileInput');
			const fileInfo = document.getElementById('fileInfo');
			const fileName = document.getElementById('fileName');
			const fileSize = document.getElementById('fileSize');
			const uploadBtn = document.getElementById('uploadBtn');
			const progressBar = document.getElementById('progressBar');
			const progressFill = document.getElementById('progressFill');
			const result = document.getElementById('result');
			
			let selectedFile = null;
			
			// Click to upload
			uploadArea.addEventListener('click', () => {
				fileInput.click();
			});
			
			// Drag and drop
			uploadArea.addEventListener('dragover', (e) => {
				e.preventDefault();
				uploadArea.classList.add('dragover');
			});
			
			uploadArea.addEventListener('dragleave', () => {
				uploadArea.classList.remove('dragover');
			});
			
			uploadArea.addEventListener('drop', (e) => {
				e.preventDefault();
				uploadArea.classList.remove('dragover');
				const files = e.dataTransfer.files;
				if (files.length > 0) {
					handleFile(files[0]);
				}
			});
			
			// File input change
			fileInput.addEventListener('change', (e) => {
				if (e.target.files.length > 0) {
					handleFile(e.target.files[0]);
				}
			});
			
			// Handle file selection
			function handleFile(file) {
				if (!file.type.startsWith('audio/')) {
					alert('Please select an audio file.');
					return;
				}
				
				selectedFile = file;
				fileName.textContent = file.name;
				fileSize.textContent = formatFileSize(file.size);
				fileInfo.classList.add('show');
				uploadBtn.classList.add('show');
				uploadBtn.disabled = false;
				result.classList.remove('show');
			}
			
			// Format file size
			function formatFileSize(bytes) {
				if (bytes === 0) return '0 Bytes';
				const k = 1024;
				const sizes = ['Bytes', 'KB', 'MB', 'GB'];
				const i = Math.floor(Math.log(bytes) / Math.log(k));
				return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
			}
			
			// Upload and process
			uploadBtn.addEventListener('click', async () => {
				if (!selectedFile) return;
				
				uploadBtn.disabled = true;
				uploadBtn.textContent = 'Processing...';
				progressBar.classList.add('show');
				result.classList.remove('show');
				
				const formData = new FormData();
				formData.append('audio', selectedFile);
				
				try {
					const response = await fetch('/upload', {
						method: 'POST',
						body: formData
					});
					
					if (!response.ok) {
						throw new Error(`HTTP error! status: ${response.status}`);
					}
					
					const data = await response.json();
					
					// Simulate progress
					let progress = 0;
					const progressInterval = setInterval(() => {
						progress += Math.random() * 30;
						if (progress > 90) progress = 90;
						progressFill.style.width = progress + '%';
					}, 200);
					
					// Complete progress
					setTimeout(() => {
						clearInterval(progressInterval);
						progressFill.style.width = '100%';
						
						setTimeout(() => {
							progressBar.classList.remove('show');
							showResult(data);
						}, 500);
					}, 2000);
					
				} catch (error) {
					console.error('Error:', error);
					progressBar.classList.remove('show');
					showError('Failed to process audio file: ' + error.message);
				} finally {
					uploadBtn.disabled = false;
					uploadBtn.textContent = 'Process Audio';
				}
			});
			
			// Show result
			function showResult(data) {
				console.log('Backend response:', data);

				if (!data || !data.aiFeatures) {
					result.innerHTML = `
						<div class="result-section">
							<h4>‚ö†Ô∏è No Output</h4>
							<p>No output was generated. Please try again or check your audio file.</p>
						</div>
					`;
					result.classList.add('show');
					return;
				}

				// Defensive: parse featureRequests if it's a string
				let featureRequests = data.aiFeatures.featureRequests;
				if (typeof featureRequests === 'string') {
					try {
						featureRequests = JSON.parse(featureRequests);
					} catch (e) {
						featureRequests = null;
					}
				}

				let resultHTML = `
					<h3>üéâ Processing Complete!</h3>
					<div class="result-section">
						<h4>üìù Transcription</h4>
						<p class="transcription-text">${'"' + (data.aiFeatures?.transcription || 'No transcription available') + '"'}</p>
					</div>
				`;

				if (featureRequests) {
					const requests = featureRequests.requests || [];
					if (requests.length > 0) {
						resultHTML += `
							<div class="result-section">
								<h4>üöÄ Feature Requests Extracted</h4>
								<div class="feature-requests">
						`;
						requests.forEach((req, index) => {
							const priorityClass = req.priority === 'high' ? 'priority-high' : 
												req.priority === 'medium' ? 'priority-medium' : 'priority-low';
							const categoryIcon = req.category === 'enhancement' ? '‚ú®' :
												req.category === 'bug-fix' ? 'üêõ' :
												req.category === 'new-feature' ? 'üÜï' : 'üîß';
							// Handle potentialRecommendation as array or string
							let recommendationContent = '';
							if (Array.isArray(req.potentialRecommendation)) {
								recommendationContent = req.potentialRecommendation.map(r => `<li>${r}</li>`).join('');
								recommendationContent = `<ul>${recommendationContent}</ul>`;
							} else if (typeof req.potentialRecommendation === 'string') {
								recommendationContent = req.potentialRecommendation.replace(/\n/g, '<br>');
							}
							resultHTML += `
								<div class="feature-request ${priorityClass}">
									<div class="request-header">
										<span class="category-icon">${categoryIcon}</span>
										<h5>${req.title}</h5>
										<span class="confidence">${Math.round((req.confidence || 0) * 100)}%</span>
									</div>
									<p class="request-description">${req.description}</p>
									${recommendationContent ? `
									<div class="potential-recommendation">
										<h6>üí° Potential Recommendations:</h6>
										<div class="recommendation-content">${recommendationContent}</div>
									</div>
									` : ''}
									<div class="request-meta">
										<span class="priority-badge ${priorityClass}">${req.priority ? req.priority.toUpperCase() : ''}</span>
										<span class="category-badge">${req.category ? req.category.replace('-', ' ') : ''}</span>
									</div>
								</div>
							`;
						});
						resultHTML += `
								</div>
								<div class="extraction-summary">
									<p><strong>Summary:</strong> ${featureRequests.summary || 'No summary available'}</p>
									<p><small>Extracted using ${featureRequests.model || 'N/A'} in ${featureRequests.extractionTimeMs || 'N/A'}ms</small></p>
								</div>
							</div>
						`;
					} else {
						resultHTML += `
							<div class="result-section">
								<h4>üîç No Feature Requests Found</h4>
								<p>No clear feature requests were identified in the audio content.</p>
								${featureRequests.summary ? `<div class="extraction-summary"><p><strong>Summary:</strong> ${featureRequests.summary}</p><p><small>Extracted using ${featureRequests.model || 'N/A'} in ${featureRequests.extractionTimeMs || 'N/A'}ms</small></p></div>` : ''}
							</div>
						`;
					}
				}

				resultHTML += `
					<div class="result-section">
						<h4>üìä Processing Details</h4>
						<p><strong>Processing Time:</strong> ${data.aiFeatures?.processingTimeMs || 'N/A'}ms</p>
						<p><strong>Model Used:</strong> ${data.aiFeatures?.model || 'N/A'}</p>
						<p><strong>Language:</strong> ${data.aiFeatures?.language?.detected || 'Unknown'} (${Math.round((data.aiFeatures?.language?.confidence || 0) * 100)}% confidence)</p>
					</div>
				`;

				result.innerHTML = resultHTML;
				result.classList.add('show');
			}
			
			// Show error
			function showError(message) {
				result.innerHTML = `
					<h3>Error</h3>
					<p>${message}</p>
				`;
				result.classList.add('show', 'error');
			}
		</script>
	</body>
</html>
